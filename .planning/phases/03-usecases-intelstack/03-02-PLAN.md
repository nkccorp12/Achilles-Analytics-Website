---
phase: 03-usecases-intelstack
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/IntelStack.jsx
  - src/pages/IntelStack.css
autonomous: true

must_haves:
  truths:
    - "User can tap to toggle Intel Report preview on touch devices (not hover-only)"
    - "Alerts panel positions correctly on narrow screens without overflow"
    - "IntelStack uses consistent 640/768/1024 breakpoints matching project standard"
  artifacts:
    - path: "src/pages/IntelStack.jsx"
      provides: "useState toggle for report preview with stopPropagation on button"
      contains: "reportPreviewActive"
    - path: "src/pages/IntelStack.css"
      provides: "Active state classes for report, alerts panel mobile fix, normalized breakpoints"
      contains: "vg-istack__report--active"
  key_links:
    - from: "src/pages/IntelStack.jsx"
      to: "src/pages/IntelStack.css"
      via: "className with --active modifier"
      pattern: "report--active"
    - from: "src/pages/IntelStack.css"
      to: "alerts panel mobile positioning"
      via: "640px media query with max-width constraint"
      pattern: "max-width.*calc"
---

<objective>
Add click/tap toggle for IntelStack report preview, fix alerts panel positioning on mobile, and normalize breakpoints from 768px to 640px.

Purpose: INTEL-01 (report preview inaccessible on touch), INTEL-02 (alerts panel overflows on narrow screens), INTEL-03 (IntelStack uses 768px breakpoint instead of project standard 640px). The report preview is completely hidden from touch users since it only shows on :hover. The alerts panel has no max-width constraint and can overflow on narrow devices.
Output: IntelStack.jsx with toggle state, IntelStack.css with --active classes, fixed alerts panel, normalized breakpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/pages/IntelStack.jsx
@src/pages/IntelStack.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add report preview toggle state to IntelStack.jsx</name>
  <files>src/pages/IntelStack.jsx</files>
  <action>
    Inside the `IntelStack()` function, after the existing `biasAnim` state declaration (line 229), add:
    ```
    const [reportPreviewActive, setReportPreviewActive] = useState(false);
    ```

    On the report div (line 578, `<div className="vg-istack__report">`), modify to:
    ```jsx
    <div
      className={`vg-istack__report${reportPreviewActive ? ' vg-istack__report--active' : ''}`}
      onClick={() => setReportPreviewActive(!reportPreviewActive)}
    >
    ```

    On the "Generate Latest Brief" button (line 619), add `e.stopPropagation()` to prevent the click from toggling the preview state:
    ```jsx
    <button
      className="vg-istack__report-btn"
      onClick={(e) => {
        e.stopPropagation();
      }}
    >
      Generate Latest Brief
    </button>
    ```

    Keep all existing content and structure inside the report div unchanged. Only modify the outer div's className/onClick and the button's onClick.
  </action>
  <verify>Open IntelStack.jsx and confirm: (1) `reportPreviewActive` state declared, (2) report div has conditional --active class and onClick, (3) button has `e.stopPropagation()`.</verify>
  <done>IntelStack.jsx has click/tap toggle for report preview with button click isolation.</done>
</task>

<task type="auto">
  <name>Task 2: Add --active CSS, normalize breakpoints, fix alerts panel in IntelStack.css</name>
  <files>src/pages/IntelStack.css</files>
  <action>
    Three changes in this file:

    **A. Report preview --active classes:**

    Add `cursor: pointer;` and `user-select: none;` to the base `.vg-istack__report` rule (line 745-756).

    Modify ALL existing `:hover` rules for the report to include `--active` selector using comma separation. There are many rules to update (lines 854-929). For each one:

    - `.vg-istack__report:hover .vg-istack__report-default` -> add `, .vg-istack__report--active .vg-istack__report-default`
    - `.vg-istack__report:hover .vg-istack__report-preview` -> add `, .vg-istack__report--active .vg-istack__report-preview`
    - `.vg-istack__report:hover .vg-istack__brief-item--1` through `--5` -> add `, .vg-istack__report--active .vg-istack__brief-item--1` etc. for each
    - `.vg-istack__report:hover .vg-istack__brief-item--1 .vg-istack__brief-bar > span` through `--4` -> add matching `--active` selectors for each

    This is the complete list of hover rules that need --active duplicates:
    1. Line 854-858: report-default hide
    2. Line 860-863: report-preview show
    3. Line 878: brief-item--1
    4. Line 879: brief-item--2
    5. Line 880: brief-item--3
    6. Line 881: brief-item--4
    7. Line 882: brief-item--5
    8. Line 926: brief-bar span item--1
    9. Line 927: brief-bar span item--2
    10. Line 928: brief-bar span item--3
    11. Line 929: brief-bar span item--4

    **B. Breakpoint normalization (INTEL-03):**

    Change the mobile media query from `@media (max-width: 768px)` (line 1008) to `@media (max-width: 640px)`.

    This is the only breakpoint that needs changing -- the 1024px tablet breakpoint is already correct.

    **C. Alerts panel mobile fix (INTEL-02):**

    Inside the now-640px mobile media query, add rules for the alerts panel:
    ```css
    .vg-istack__alerts-panel {
      top: 12px;
      right: 12px;
      padding: 10px 12px;
      max-width: calc(100% - 24px);
    }

    .vg-istack__alerts-title {
      font-size: 11px;
    }

    .vg-istack__alert-row {
      font-size: 11px;
      gap: 12px;
    }
    ```

    These rules ensure the absolutely-positioned alerts panel cannot overflow the viewport on narrow screens.
  </action>
  <verify>
    1. grep for `--active` in IntelStack.css -- must find selectors for report-default, report-preview, all 5 brief-items, and all 4 brief-bar spans (11 rule groups total)
    2. grep for `768px` in IntelStack.css -- must return NO results (all normalized to 640px)
    3. grep for `max-width.*calc` in IntelStack.css -- must find the alerts panel constraint
    4. grep for `cursor: pointer` in IntelStack.css -- must find on .vg-istack__report base rule
  </verify>
  <done>IntelStack.css has --active selectors for all report hover rules, mobile breakpoint normalized from 768px to 640px, and alerts panel constrained with max-width on mobile.</done>
</task>

</tasks>

<verification>
1. grep for `reportPreviewActive` in IntelStack.jsx -- must find state declaration and className usage
2. grep for `stopPropagation` in IntelStack.jsx -- must find on button onClick
3. grep for `768px` in IntelStack.css -- must return 0 results
4. grep for `640px` in IntelStack.css -- must find mobile media query
5. grep for `report--active` in IntelStack.css -- must find multiple occurrences
6. grep for `max-width.*calc` in IntelStack.css -- must find alerts panel constraint
</verification>

<success_criteria>
- IntelStack.jsx has reportPreviewActive toggle with onClick on report div and stopPropagation on button
- IntelStack.css has --active selectors alongside ALL 11 report :hover rule groups
- Mobile breakpoint changed from 768px to 640px (zero instances of 768px remain)
- Alerts panel has max-width constraint preventing overflow on narrow screens
- No new breakpoints introduced outside the 640/1024 standard
</success_criteria>

<output>
After completion, create `.planning/phases/03-usecases-intelstack/03-02-SUMMARY.md`
</output>
